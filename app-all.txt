from flask import (Flask, render_template, make_response, url_for, request,
                   redirect, flash, session, send_from_directory, jsonify)
from datetime import datetime
from werkzeug.utils import secure_filename
import bcrypt
import pyqueries
app = Flask(__name__)

# one or the other of these. Defaults to MySQL (PyMySQL)
# change comment characters to switch to SQLite

import cs304dbi as dbi

# import cs304dbi_sqlite3 as dbi
app.config['UPLOADS'] = 'uploads'
app.config['MAX_CONTENT_LENGTH'] = 5 * 1024 * 1024 

import random
import helper

app.secret_key = 'your secret here'
# replace that with a random key
app.secret_key = ''.join([ random.choice(('ABCDEFGHIJKLMNOPQRSTUVXYZ' +
                                          'abcdefghijklmnopqrstuvxyz' +
                                          '0123456789'))
                           for i in range(20) ])

# This gets us better error messages for certain common request errors
app.config['TRAP_BAD_REQUEST_ERRORS'] = True

@app.route('/', methods = ['GET', 'POST'])
def index():
    """ This is our main page it contains a login form or new users can create an account"""
    if request.method == 'GET': 
        return render_template('login.html', header ='Welcome to Wendy Works!', logo='wendyworks.png')
    else:
        action = request.form.get("action")
        if action == 'Login':
            pw = request.form.get("passw")
            user = request.form.get("username")
            if not pw or not user:
                return render_template('login.html', header ='Welcome to Wendy Works!', message='Fields username and password are required', logo='wendyworks.png')
            else:
                 #will use this in login route
                session['temporary_username'] = user
                session['temporary_password'] = pw
                return redirect(url_for('login'))
        else:
            if action == 'Create Account':
                return redirect(url_for('join'))
        
@app.route('/login/')
def login(): 
    """This function serves to log users in if they exists ensuring 
    that their credentials are correct or directs users to create an account """
    print("METHOD",request.method)
    #removes temp data from session
    user = session.pop('temporary_username', None)
    pw = session.pop('temporary_password', None)
    print("USER", user)
    conn = dbi.connect()
    result = pyqueries.login_user(conn, user, pw)
    print("Result", result)
    try: 
        #if the user is in the database
        if result >=1:
            #timestamp = datetime.now() #not sure if we need this
            #ip = str(request.remote_addr) #not sure if we need this
            session['uid'] = result 
            # pyqueries.setsession(conn,result, timestamp, ip)
            return redirect(url_for('profile', uid = result))
        #if incorrect password
        elif result is False:
            flash('Sorry, your password is incorrect, try again')
            return redirect(url_for('index'))
    #if that username is not in the db
    except Exception as e: 
        if user != None: 
            flash(f'Sorry, no account with username: {user} found. Create an account')
        return(redirect(url_for('index')))
 
@app.route('/uploads/<filename>')
def uploaded_file(filename):
    """Function serves to get uploaded file"""
    return send_from_directory(app.config['UPLOADS'], filename)


@app.route('/photo/', methods = ['GET', 'POST'])
def profile_photo(): 
    '''
     the user's profile photo is saved in db 
     or the photo upload page is shown 
    '''
    user = session.get('uid')
    if request.method == 'GET':
        return render_template('photo_upload.html', current_us=user,logo='wendyworks.png')
    else:
        conn = dbi.connect() 
        p = request.files["pic"]
        user_filename = p.filename
        ext = user_filename.split('.')[-1]
        print("EXT", ext)
        if ext == 'jpeg':
            filename = secure_filename('{}.{}'.format(user, ext))

            # Check and delete old photo
            old_photo_path = os.path.join(app.config['UPLOADS'], f"{user}.{ext}")
            if os.path.isfile(old_photo_path):
                os.remove(old_photo_path)
            # save new 
            pathname = os.path.join(app.config['UPLOADS'], filename)
            p.save(pathname)
            # Store photo info in db
            pyqueries.insert_photo(conn, user, filename)
            flash("Photo Upload Successful!")
        else:
            flash("Please upload a JPEG.")

        # Redirect to the user's profile
        return redirect(url_for('profile', uid=user))
    
    


@app.route('/join/', methods=["GET", "POST"])
def join():
    """This route is used when users are creating a new account, the form takes 
    user skills, and contact information to insert them into the database"""
    conn = dbi.connect()
    if request.method == 'GET':
        return render_template('create.html', header ='Create an Account', logo = 'wendyworks.png')
    else: #request method is POST
       
        try: #getting account information first 
            username = request.form.get("username") 
            pass1=request.form.get("pswrd") 
            pass2=request.form.get("pswrd-repeat")
        #getting contact information
            email=request.form.get("email")
            f_name=request.form.get("f_name")
            l_name=request.form.get("l_name")
        #getting checked skills as a list 
            skills=request.form.getlist("skills")
            print("Skills", skills)
        #getting other skills, changing into a list 
            other_skills = request.form.get("other_skills").split(",")


        #checking if passwords match before creating account 
        #or inserting anything 
            if pass1 != pass2:
                flash('passwords do not match')
                return redirect( url_for('index'))
            
            hashed = bcrypt.hashpw(pass1.encode('utf-8'),
                        bcrypt.gensalt())
            stored = hashed.decode('utf-8')
       
       #if usernam does not exist, continue inserting 
        #inserting into database
            pyqueries.insert_new_user(conn,username,email,f_name,l_name,stored)
        #getting last uid
            row = pyqueries.get_uid(conn)
            uid = row.get("last_insert_id()")
            
            
        #inserting skills 
            pyqueries.insert_skills(conn,uid,skills)

            if len(other_skills) > 0:
                pyqueries.insert_other_skills(conn, uid, other_skills)

            
            flash('Account created! Please log in')
            return redirect(url_for("index"))

        except Exception as err:
            flash('form submission error'+ str(err))
            return redirect( url_for('index') )
      
@app.route('/search/', methods = ["GET", "POST"])
def search():
    """This route gets information from search form 
    to find and display prodvider or requestor posts
    Return: renders search form or search result page
     """

    conn = dbi.connect() 
    print(request.method)
    if request.method == 'GET':
        return render_template('search.html', header ='Search for a post',logo='wendyworks.png')
    else: #method should be post 
        u_input = request.form.get('query')
        u_kind = request.form.get('kind')
        print(u_input)
        print(u_kind)
        if u_kind == 'provision':
            providers = helper.providers(conn, u_input)
            return render_template('providers.html', key_phrase=u_input, providers = providers, logo='wendyworks.png')
        if u_kind == 'request':
            requests = helper.find_requests(conn, u_input)
            return render_template('requests.html', key_phrase=u_input, requests = requests, logo='wendyworks.png')



@app.route('/insert/', methods=["GET", "POST"])
def insert_post():
    '''
    This function is for a user to create a post 
    in which they indicate whether a post is requesting or 
    providing and the skills they need or give give
    Redirects to profile page 
    '''
    conn = dbi.connect()
    
    if request.method == 'GET':
        return render_template('insert_post.html', logo='wendyworks.png')
    else:
        # Collect relevant form information into variables
        uid = session.get('uid')
        date = datetime.now()
        print(uid)
        title = request.form.get('title')
        body = request.form.get('body')
        categories = request.form.getlist('category')
        print(categories)
        type = request.form.get('type')
        # Flash messages accordingly for missing inputs
        if not body:
            flash('missing input: no body text')
        if not type:
            flash('missing input: no type')
        if not title:
            flash('missing input: no title')
        if not categories:
            flash('missing input: no category selected')
        # If any one of the inputs or combination of inputs is missing, 
        # redirect them to fill out the form again.
        if not body or not title or not categories or not type or str(title).isnumeric():
            return redirect(url_for('insert_post'))
        
        helper.insert_post(conn, uid, title, body, categories, type, date)
        post_id = helper.get_pid(conn)
        pid = post_id['last_insert_id()']
     
        flash('Your post was inserted successfully')
        return redirect(url_for('profile', uid=uid))




@app.route('/profile/<int:uid>', methods = ["GET", "POST"])
def profile(uid):
    """
    This function is used for the profile page, getting all
    of the user's information to be displayed
    Return: renders account page 
    """
    if session.get('uid') == uid: 
        conn = dbi.connect() 
        information = pyqueries.get_account_info(conn, uid)
        skills = pyqueries.get_skills(conn, uid) 
        u_posts = helper.user_posts(conn, uid)
        #useid = information['uid')
        if request.method == 'GET': 
            user_photo = pyqueries.get_photo(conn, uid)
            print("PHOTO", user_photo)
            if user_photo == None:
                return render_template("account_page.html", userdata = information, all_skills = skills, usid = uid, posts = u_posts, logo='wendyworks.png')
            else:
                p_user = user_photo['filename']
                photo_url = url_for('uploaded_file', filename=p_user)
                print("PHOTO_URL", photo_url)
                #photo = send_from_directory(app.config['UPLOADS'],p_user)
                return render_template("account_page.html", userdata = information, all_skills = skills, usid = uid, picture = photo_url, posts = u_posts, logo='wendyworks.png') 
        else:  
            return redirect(url_for('update', user = uid))
    else: 
        flash("Sorry, you cannot access this page")
        user = session.get('uid')
        return(redirect(url_for('profile', uid= user)))
  

@app.route('/update/<int:user>', methods = ["GET","POST"])
def update(user):
    """
    Any changes the user makes to their information 
    runs through this function
    updates the database or displays update form
    Returns: redirects to profile 
    """
    conn = dbi.connect() 
    if request.method == "POST": 
        firstnm = request.form.get('fname')
        lastnm = request.form.get('lname')
        mail = request.form.get('email')
        username = request.form.get('username')
        skills_input = request.form.get('skills')
        #remove old skills from the db
        pyqueries.delSkills(conn, user)
        updated_skills = [skill.strip() for skill in skills_input.split(',')]
        #add new skills to the db
        pyqueries.insert_other_skills(conn, user, updated_skills)
        #userid stays the same so this is just updating additional info
        pyqueries.updateUser(conn, user, firstnm, lastnm, mail, username)
        return redirect(url_for('profile', uid = user))
    else: #method is get
        action = request.args.get('action')
        if action == 'UploadPhoto':
            return redirect(url_for('profile_photo'))
        else:
            info = pyqueries.get_account_info(conn, user)
            uskills = pyqueries.get_skills(conn, user)
            print("Skills ", uskills)
            return render_template("update_profile.html", account = info, skills = uskills, user = user, logo='wendyworks.png')


@app.route('/logout/')
def logout():
    """
    Logs the user out and ends the session
    """
    session.pop('uid', None)
    flash("You've logged out, please visit again soon!")
    #end the session here 
    return redirect(url_for('index'))


if __name__ == '__main__':
    import sys, os
    if len(sys.argv) > 1:
        # arg, if any, is the desired port number
        port = int(sys.argv[1])
        assert(port>1024)
    else:
        port = os.getuid()
    db_to_use = 'wworks_db' 
    print('will connect to {}'.format(db_to_use))
    dbi.conf(db_to_use)
    app.debug = True
    app.run('0.0.0.0',port)
import cs304dbi as dbi


def insert_post(conn, uid, title, body, categories, type, date):
    '''
    Helper function to insert a created post into the database
    '''
    curs = dbi.dict_cursor(conn)
    curs.execute('''
                 INSERT INTO post(uid, title, body, categories, type, post_date)
                 VALUES (%s, %s, %s, %s, %s, %s)
                 ''', [uid, title, body, categories, type, date])
    conn.commit()
    return


def get_user(conn, username):
    '''
    Helper function find user by username 
    Returns user
    '''
    curs = dbi.dict_cursor(conn)
    curs.execute('''
                 SELECT uid 
                 from user
                 where username = %s
                 ''', [username])
    return curs.fetchone()

def get_post(conn, pid):
    '''
    Helper function to get a post given its pid
    returns post 
    '''
    curs = dbi.dict_cursor(conn)
    curs.execute('''
                 SELECT * from post 
                 WHERE pid = %s
                 ''', [pid])
    return curs.fetchone()

def user_posts(conn, uid):
    '''
    gets all posts from a specified user if
    it is not distinctly closed
    returns lists of posts by uid 
    '''
    curs = dbi.dict_cursor(conn)
    curs.execute('''
                select pid, title, body, status, categories
                 from post where uid=%s
                 ''',[uid])
    return curs.fetchall()


def get_pid(conn):
    """A quick helper function to get uid using
      last-insert
      Using until we fix transactions"""
    curs = dbi.dict_cursor(conn)
    curs.execute('''select last_insert_id()''')
    return curs.fetchone()

def find_requests(conn, key_phrase):
    '''
    Helper function to find posts including the relevant keyword 
    for a request
    returns lists of posts labeled as request by phrase 
    '''
    curs = dbi.dict_cursor(conn)
    curs.execute('''
                 select *
                 from post, user
                 where body like (%s) and type = 'request' and post.uid = user.uid
                 ''', ['%' + key_phrase + '%'])

    return curs.fetchall()


def providers(conn, key_phrase):
    '''
    Helper function to find users who can provide a service
    based on the categories that the "provider" has linked to
    their account
    returns lists of posts labeled as provision by phrase
    '''
    curs = dbi.dict_cursor(conn)
    curs.execute('''
                 select *
                 from post,user
                 where body like (%s) and type = 'provision' and post.uid = user.uid
                 ''', ['%' + key_phrase + '%'])
    return curs.fetchall()




import cs304dbi as dbi
import bcrypt
# import cs304dbi_sqlite3 as dbi

def insert_new_user(conn,username,email,f_name,l_name,hashed):
    '''
    Takes user account information and inserts in to the user table database 
    '''
    curs = dbi.dict_cursor(conn)
    try:
        curs.execute('''
                 INSERT INTO user(username,email,f_name,l_name,`password`) 
                 VALUES (%s,%s,%s,%s,%s)
                 ''',
                 [username,email,f_name,l_name,hashed])
        conn.commit() 
    except Exception as err:
        return ('Error: {}'.format(repr(err)))
 


def get_uid(conn):
    """A quick helper function to get uid using last-insert
    Note: Just using until we fix transactions"""
    curs = dbi.dict_cursor(conn)
    curs.execute('''select last_insert_id()''')
    return curs.fetchone()




def insert_skills(conn, uid,skills):
    """This function intends to insert any skills users have checked
    or have added in as other"""
    curs = dbi.dict_cursor(conn)
    for skill in skills:
        curs.execute('''
                    INSERT INTO skills(uid,skill) 
                    VALUES (%s,%s)
                    ''',
                    [uid,skill])
        conn.commit()
    
def get_photo(conn, uid): 
    '''
    gets the user's profile photo from
    the db
    '''
    curs = dbi.dict_cursor(conn)
    curs.execute('''select filename from picfile where 
                 uid=%s''', [uid]
                 )
    return curs.fetchone() 

def insert_photo(conn, uid, filename):
    '''
    Inserts a new photo into the database or updates the existing one if the uid already exists.
    '''
    curs = dbi.dict_cursor(conn)

    # check if the uid is already in the database
    curs.execute('''SELECT * FROM picfile WHERE uid = %s''', [uid])
    if curs.fetchone():
        # If uid exists, update 
        curs.execute('''UPDATE picfile SET filename = %s WHERE uid = %s''', [filename, uid])
    else:
        # If uid does not exist, insert 
        curs.execute('''INSERT INTO picfile(uid, filename) VALUES (%s, %s)''', [uid, filename])

    conn.commit()


def insert_other_skills(conn, uid, other_skills):
    """This function intends to insert any skills users have checked
    or have added in as other"""
    curs = dbi.dict_cursor(conn)
    for skill in other_skills:
        if skill!= '':
            curs.execute('''
                    INSERT INTO skills(uid,skill) 
                    VALUES (%s,%s)
                    ''',
                    [uid,skill])
            conn.commit()
    


def get_skills(conn, uid): 
    """
    This function gets all skills
    that the user has in the database
    returns lists of skills by user id 
    """
    curs = dbi.dict_cursor(conn)
    curs.execute('''
                select * from skills where uid= (%s)
                 ''', [uid]) 
    return curs.fetchall()


def get_account_info(conn,uid):
    """
    Gets account using uid 
    This function returns users information using uid 
      """
    curs = dbi.dict_cursor(conn)
    curs.execute('''
                    select * from user where uid= (%s)
                    ''',
                    [uid])
    return curs.fetchone()

    

def login_user(conn, username, pass1):
    """
    This function checks if the input and hashed
    passwords are the same and returns the uid, false, 
    or, if not found, None

    """ 
    curs = dbi.dict_cursor(conn)
    curs.execute('''
                 select f_name, `uid`, `password` from user 
                 where username= (%s)
                 ''', [username])
    element = curs.fetchone() 
    if element is not None: 
        passw = element['password']
        hashed2 = bcrypt.hashpw(pass1.encode('utf-8'), passw.encode('utf-8'))
        hashed2_str = hashed2.decode('utf-8')
        if hashed2_str == passw:
            return element['uid']
        else: 
            return False

def updateUser(conn, user, firstnm, lastnm, mail, username):
    """
    Updates the user's information in the database
    """
    curs = dbi.dict_cursor(conn)
    curs.execute('''
                    update user set username = %s, email = %s, f_name = %s, l_name = %s
                    where `uid`=(%s)
                 ''', [username, mail, firstnm, lastnm, user])   
    conn.commit() 
    

def delSkills(conn, user): 
    """
    Removes skills in the database
    """
    curs = dbi.dict_cursor(conn)
    curs.execute('''
                delete from skills where uid =(%s)
                 ''', [user])
    conn.commit() 

def setsession(conn, result, timestamp, uip): 
    """
    sets session information for the database
    will be utilized in next version of project
    """
    curs = dbi.dict_cursor(conn)
    curs.execute('''
    INSERT INTO session (`uid`, st, ip) 
    VALUES (%s, %s, %s)
     ''', [result,timestamp, uip])
    conn.commit() 



USE wworks_db;

INSERT INTO `user` (username, email, f_name, l_name, `password`, skills) VALUES
('nd105', 'nd105@wellesley.edu', 'Noelle', 'Davis', 'pw123', 'sewing, fitness ,car'),
('janedoe', 'jane.doe@wellesley.edu', 'Jane','Doe','pw456', 'car'),
('wendywells', 'ww123@wellesley.edu', 'Wendy', 'Wellesley', 'redtomato', 'automobile');


INSERT INTO `post` (`uid`, `title`, `body`, `post_date`, `categories`, `status`) VALUES
(1, 'The Best Fitness Routines?', 'In the KSC, how do I use the stairmaster?', '2023-09-10', 'fitness', 'open'),
(1, 'Photography Tips for Beginners?', 'When framing Galen Stone Tower, how do I keep the light from reflecting in my lens? ', '2023-10-02', 'photography', 'in progress'),
(2, 'DIY Crafts for Home Decor?', 'I need help creating a wreath', '2023-08-20', 'crafts', 'closed');


INSERT INTO `replies` (`pid`, `uid`, `body`) VALUES
(1, 2, ' Hopping on the Stair master now! I can show you SO soon :)'),
(2, 3, 'I have some photography tips! Let me know when you are free'),
(1, 2, 'DIY Crafts are really my thing! I make fall decor all the time');USE wworks_db;

DROP TABLE IF EXISTS replies;
DROP TABLE IF EXISTS post;
DROP TABLE IF EXISTS picfile; 
DROP TABLE IF EXISTS skills; 
DROP TABLE IF EXISTS session; 
DROP TABLE IF EXISTS user;



CREATE TABLE user (
  `uid` INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(25) NOT NULL ,
  email VARCHAR(25) NOT NULL,
  f_name VARCHAR(20),
  l_name VARCHAR(50),
  `password` VARCHAR(60) NOT NULL
) 
engine=InnoDB;

create table session (
  `uid` INT NOT NULL, 
  st timestamp, 
  ip char(15),  
  foreign key (`uid`) references user (`uid`)
  )
  engine = InnoDB;

CREATE TABLE skills (
  `uid` INT NOT NULL, 
  skill VARCHAR(30),
  foreign key (`uid`) references user(`uid`) 
)
engine=InnoDB;

create table picfile (
    `uid`int NOT NULL, 
    filename varchar(50),
    foreign key (`uid`) references user(`uid`) 
        on delete cascade on update cascade
)
engine = InnoDB;


CREATE TABLE post (
  pid INT AUTO_INCREMENT PRIMARY KEY,
  `uid` INT NOT NULL, 
  title VARCHAR(40) NOT NULL, 
  body TEXT NOT NULL, 
  post_date DATE NOT NULL,
  categories SET('clothing', 'fitness', 'beauty', 'crafts', 'transportation', 'photography', 'other') NOT NULL,
  `type` ENUM('request', 'provision'), 
  `status` ENUM('open', 'closed', 'in progress') NOT NULL, 
  foreign key (`uid`) references user(`uid`) 
        on update restrict 
        on delete restrict 
        ) 
engine=InnoDB;


CREATE TABLE replies (
  rid INT AUTO_INCREMENT PRIMARY KEY,
  pid INT NOT NULL,
  `uid` INT NOT NULL,
  body TEXT NOT NULL,
  foreign key (pid) references post(pid) 
    on update restrict 
    on delete restrict
) 
engine=InnoDB;
{% extends "base.html" %}

{% block main_content %}

    <h1>Welcome {{userdata.f_name }}!</h1>


    <form method ="GET" action="{{url_for('update', user=usid)}}">
        <div> 
            {% if picture %}
            
             <img src="{{ picture }}" alt="User Photo" class="circular-image">
            {% endif %}
        </div>


        <div class="information-box">
            <h2>Your Information:</h2>
            <p> Name: {{userdata.f_name}} {{userdata.l_name}} </p>
            <p>Username: {{userdata.username}}</p>
            <p>Email: {{userdata.email}}</p>

           
            {% if posts %}
             <h2>Your Posts:</h2>
                <div class="profile_posts_container">
                    {% for post in posts %}
                        <table class="profile_posts"> 
                            <tr> 
                                <th>Title</th> 
                                <th>Body</th>
                                <th>Categories</th> 
                                <th>Post Status</th>
                            </tr> 
                            <tr> 
                                <td>{{ post.title }}</td> 
                                <td>{{ post.body }}</td>
                                <td>{{ post.categories }}</td> 
                                <td>{{ post.status }}</td>
                            </tr> 
                        </table>
                    {% endfor %}
                </div>
            {% endif %}
        
        
           

            <h3 class="your-skills">Your Skills:</h3>
            <div>
            <ul>
                {% if all_skills %}
                    {% for task in all_skills %}
                    <li>{{ task.skill }}</li>
                    {% endfor %}
                {%endif%}
                </ul>
            </div>
            <button class ="button" type="submit" name="action" value="Update">Update</button>
            <button class= "button" type="submit" name="action" value="UploadPhoto">Upload Photo</button>
        </div>
    </form>
    <div> 
</div>



{% endblock %}<!doctype html>
<html lang='en'>
<head>
    <meta charset='utf-8'>
    <!-- for mobile-friendly pages -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name=author content="">
    <title>Wendy Works is a website for on campus task completion by Wellesley students for Wellesely students</title>
    <link rel='stylesheet' href="{{ url_for('static', filename = 'style.css') }}">
    {% block head_stuff %} {% endblock %}
</head>
<body>

            
{% block nav %}
<nav class="navbar">
  <img src="{{url_for('static', filename='images/'+ logo)}}" 
  alt="Logo for WendyWorks in blue font">
  <ul>
    {% if 'uid' in session %}
      <li><a href="{{ url_for('profile', uid=session['uid']) }}">Profile</a></li>
      <li><a href="{{url_for('search')}}"> Search Posts</a></li>
      <li><a href="{{url_for('insert_post')}}"> New Post</a></li>
      <li><a href="{{ url_for('logout') }}">Logout</a></li>
      
    {% endif %}
  </ul>
</nav>

{% with messages = get_flashed_messages() %}
{% if messages %}
<div id="messages">
  {% for msg in messages %}
  <p>{{msg}}</p>
  {% endfor %}
</div>
{% endif %}
{% endwith %}
{% endblock %}

{% block main_content %}
<h1>Welcome!</h1>
{% endblock %}

  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  {% block end_scripts %}
  {% endblock %}
  
</body>
</html>
{% extends "base.html" %}

{% block main_content %}
<h1>{{header}}</h1>

<form method=post action="{{url_for('join')}}">
  <p> Sign up using this form:</p>
 
  <table>


    <tbody>
        <tr>
            <td><label for="email"><b>Wellesley Email</b></label></td>
            <td><input type="text" placeholder="Enter Email" name="email" 
                id="email" required></td>
        </tr>
        
        <tr>
            <td><label for="f_name"><b>First name: </b></label></td>
            <td><input type="text" placeholder="Enter first name" name="f_name" 
                id="f_name" required></td>
        </tr>
        
        <tr>
            <td><label for="l_name"><b>Last name: </b></label></td>
            <td><input type="text" placeholder="Enter last name" name="l_name"
                id="l_name" required></td>
        </tr>
        
    
    <tr>
        <td><label for="username"><b>Username</b></label></td>
        <td><input type="text" placeholder="Username" name="username" 
            id="username" required></td>
    </tr>
    
    <tr>
        <td><label for="psw"><b>Password</b></label></td>
        <td><input type="password" placeholder="Enter Password" name="pswrd" 
            id= "psw" required></td>
    </tr>
    
    <tr>
        <td><label for="psw-repeat"><b>Repeat Password</b></label></td>
        <td><input type="password" placeholder="Repeat Password" 
            name="pswrd-repeat" id="psw-repeat" required></td>
    </tr>
    
    <tr>
        <td colspan="2">
            <p>Please check off any skills you are interested in providing.</p>
            <label>
                <input type="checkbox" name="skills" value="cooking"> Cooking
            </label>
            <br>
            <label>
                <input type="checkbox" name="skills" value="crafts" > Crafts
            </label><br>
            <label>
                <input type="checkbox"  name="skills" value="fitness" > Fitness
            </label><br>
            <label>
                <input type="checkbox"  name="skills" value="sewing" > Sewing
            </label><br>
            <label>
                <input type="checkbox" name="skills" value="transportation"> Transportation
            </label>
        </td>
    </tr>

    <tr>
        <td colspan="2">
            <p>Are you looking to provide any skills we don't have listed? 
            Please enter any skills you have seperated by a comma 
            (e.g cooking,sewing)</p>
            <label for="other_skills"><b>Other skills</b></label>
            <input type="text" placeholder="Enter skills" name="other_skills"
            id="other_skills">
        </td>
    </tr>
    </tbody>
</table>


<p> <input type='submit' value='Submit'> </p>


</form>



{% endblock %}{% extends "base.html" %}

{% block main_content %}
    <form  method=post action="{{url_for('insert_post')}}">
        <fieldset>
        <legend>Make a post</legend>
        <table>
                <tr><td><label for="title" accesskey="i"> Title your post:</label></td>
                <td><input id="title" type="text" name="title"></td></tr>

            <tr><td><label for="body" accesskey="t"> Describe your request or service:</label></td>
                <td><textarea id="body" name="body" rows="5" cols="33"></textarea></tr>
                
            <tr>
                <td><label accesskey="r">Is this a request or service:</label> <br></td>
                
               
                <td>
                    <label for="provision">Provision</label>
                    <input type="checkbox" id = "provision" name="type" value="provision">
                   
                

                    <label for="request">Request</label>
                    <input id ="request" type="checkbox" name="type" value="request">
                
                
                </td></tr>
            
            <tr><td><label  accesskey="r"> Check off relevant categories:</label> <br> </td>
            
            <td>    
            <label for="clothing">Clothing (sewing, hemming, etc.)</label>
            <input type="checkbox" id="clothing" name="category" value="clothing">
            
            <br>
            <label for="fitness">Fitness</label>
            <input type="checkbox" id="fitness" name="category" value="fitness">
           
            <br> 
            <label for="beauty">Beauty</label>
            <input type="checkbox" id="beauty" name="category" value="beauty">
            
            <br> 
            <label for="crafts">Crafts</label>
            <input type="checkbox" id="crafts" name="category" value="crafts">
            
            <br> 
            <label for="transportation">Transportation</label>
            <input type="checkbox" id="transportation" name="category" value="transportation">
            
            <br>
            <label for="photo">Photography</label>
            <input type="checkbox" id="photo" name="category" value="photo">
            
            <br>
            <label for="other">Other</label>
            <input type="checkbox" id="other" name="category" value="other">
            
            
            </td></tr>
        </table>
        </fieldset>

        <p> <input type='submit' value='Upload Post'> </p>

    </form>

{% endblock %}{% extends "base.html" %}

{% block main_content %}
<h1>{{header}}</h1>

<p>{{message}}</p>
<form method="post" action="{{url_for('index')}}">
    
    <div class="form-group">
        <label for="username"><b>Username: </b></label>
        <input type="text" placeholder="Enter username" name="username" id="username">
    </div>
    <div class="form-group">
        <label for="passw"><b>Password: </b></label>
        <input type="password" placeholder="Enter password" name="passw" id="passw">
    </div>
    <button type="submit" name="action" value="Login">Login</button>
    <p> Don't have an account?</p>
    <button type="submit" name="action" value="Create Account">Create Account</button>
</form>


{% endblock %}{% extends "base.html" %}

{% block main_content %}
<h1>{{header}}</h1>

<div class="centered-buttons">
    <div class="button-container">
        <a href="{{ url_for('join') }}" class="button">Create an Account</a>
    </div>
    <div class="button-container">
        <a href="{{ url_for('login') }}" class="button">Login</a>
    </div>
</div>

{% endblock %}

{% extends "base.html" %}

{% block main_content %}
<h1>{{header}}</h1>

<div class="photobox">
    <form method="POST" action="{{url_for('profile_photo')}}" enctype="multipart/form-data">
        <p><label>Change Photo: <input type="file" name="pic"></label></p>
        <button><input type="submit" value="upload"></button>
    </form>
</div>

{% endblock %}{% extends "base.html" %}

{% block main_content %}
<p>This page will show a list of providers who made a post. This page is ideal for those looking for someone to provide them with a service</p>
{%if providers%}
<p>Provider posts matching {{key_phrase}}:</p>

   
    <table class="posts"> 
    <tr>      
        <th>Title</th> 
        <th>Text</th> 
        <th>Categories</th> 
        <th>Status</th>
        <th>Post Date</th>
        <th>Contact Info</th>
    </tr> 
   
    {%for provider in providers%}

    <tr> 
        
        <td>{{provider.title}}</td> 
        <td>{{provider.body}}</td> 
        <td>{{provider.categories}}</td> 
        <td>{{provider.status}}</td>
        <td>{{provider.post_date}}</td>
        <td>{{provider.email}}</td>
    </tr> 
    {%endfor%}


</table>  
{%else%}
<h3> There are no matches for your query. </h3>

    

{%endif%}

{% endblock %}{% extends "base.html" %}

{% block main_content %}

<p>This page is displaying all requests for services. This page is for providers looking to give a service</p>
<p>Request posts matching {{key_phrase}}:</p>

    {%if requests%}
    <table class="posts"> 
        <tr>  
            <th>Title</th> 
            <th>Text</th> 
            <th>Categories</th> 
            <th>Status</th>
            <th>Post Date</th>
            <th>Contact Info</th>
        </tr> 
    {%for request in requests%}

        <tr> 
            
            <td>{{request.title}}</td> 
            <td>{{request.body}}</td> 
            <td>{{request.categories}}</td> 
            <td>{{request.status}}</td>
            <td>{{request.post_date}}</td>
            <td>{{request.email}}</td>
        </tr> 
    {%endfor%}
    </table>
      {%else%}
      <h3> There are no matches for your query. </h3>

{%endif%}

{% endblock %}{% extends "base.html" %}

{% block main_content %}
<h1>{{header}}</h1>
<div class="searchform">
    <form  method="post" action="{{url_for('search')}}">
        <label>I am looking to
            <select required name="kind">
                <option value="">choose one</option>
                <!-- i.e. I am looking to request a service -->
                <option value="provision">request a service</option>
                <!-- i.e. I am looking to provide a service -->
                <option value="request">provide a service</option>
            </select>
        </label>
        <p><label>Service subject <input type="text" required name="query"></label>
        
        <input type="submit" value="search"></p>
    </form>
</div>

{% endblock %}{% extends "base.html" %}

{% block main_content %}

<form method="POST" action="/update_post/{{pid}}">
    <fieldset>
        <legend>Update your post</legend>
        <table>
            
                <tr><td><label for="title" accesskey="i"> Title your post:</label></td>
                <td><input id="title" type="text" name="title"></td></tr>
    
            <tr><td><label for="body" accesskey="t"> Describe your request or service:</label></td>
                <td><input id="body" type="text" name="body"></td></tr>
                
            
            <tr><td><label for="category" accesskey="r"> Check off relevant categories:</label> <br>
                
            <input type="checkbox" id="clothing" name="category" value="clothing" />
            <label for="clothing">Clothing (sewing, hemming, etc.)</label>
            <br>
        
            <input type="checkbox" id="fitness" name="category" value="fitness" />
            <label for="fitness">Fitness</label>
            <br> 
            
            <input type="checkbox" id="beauty" name="category" value="beauty" />
            <label for="beauty">Beauty</label>
            <br> 
             
            <input type="checkbox" id="crafts" name="category" value="crafts" />
            <label for="crafts">Crafts</label>
             <br> 
             
            <input type="checkbox" id="transportation" name="category" value="transportation" />
            <label for="transportation">Transportation</label>
            <br>
            
            <input type="checkbox" id="photo" name="category" value="photo" />
            <label for="photo">Photography</label>
            <br>
            
            <input type="checkbox" id="other" name="category" value="other" />
            <label for="other">Other</label>
            
            </td></tr>
        </table>
        </fieldset>
    
        <p> <input type='submit' value='Upload Post'> </p>
  </form>
  {% endblock %}
{% extends "base.html" %}

{% block main_content %}

<form method="POST" action="{{url_for('update', user=user)}}">
    <table>
        <tr>
          <td><label for="fname"> First Name </label></td>
          <td><input id="fname" name='fname' value="{{account.f_name}}"></td> 
        </tr>
        <tr>
          <td><label for="lname">Last Name </label></td>
          <td><input id="lname" name='lname' value={{account.l_name}}></td>
        </tr>
        <tr>
          <td><label for="email">Email </label></td>
          <td><input id="email" name='email' value={{account.email}}></td>
        </tr>
        <tr>
            <td><label for="username">Username </label></td>
            <td><input id="username" name='username' value={{account.username}}></td>
        </tr>
        <tr>
            <td><label for="skills">Skills: </label></td>
            <td>
                <p>Please update the skills you are currently interested in providing (separated by comma)</p>
                <input type="text" name="skills" id="skills" value="{%if skills%}{% for entry in skills %}{{ entry.skill }}{% if not loop.last %}, {% endif %}{% endfor %}{%endif%}">
            </td>

            </td>
        </tr>
      </table>
      <input type="submit" name="submit" value="update">
  </form>
  {% endblock %}
/* the --color-header and others are CSS variables, which we access later. 
*/

HTML {
    --color-header: rgb(48, 117, 140);  /* color for H1-H6 and others. was deepskyblue but poor contrast. */
    --color-hilite: rgb(38, 109, 180);  /* was red, but this avoids WAVE contrast errors */ 
    --color-focus: #56B929;
    --font-family: Serif;
    font-family: var(--font-family)
}

/* For flashed messages; make them stand out using red and italics */

#messages {
    color: var(--color-hilite);
    font-style: italic;
}


   
h1 {
    text-align: center;
    font-size: 200%;
    color: var(--color-header);
 }



h2, h3 {
    color:rgb(35, 7, 119);
}
    

/* for a simple navbar. Talk to Scott if you want drop-downs. */
nav{
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

nav > ul {
    display: flex;
    flex-direction: row;
    margin-left: auto; 
}
 

nav ul {
    list-style-type: none;
    margin: 15px 0 0 0;
    padding: 0px;
   
}
nav > ul > li {
    flex: 0 0 auto;
    width: 15em; 
}
nav img{
    height: 125px;
    width: auto;
    margin-right: 0 10px;
    margin-top: 0px;


}
nav button, nav a {
    display: block;
    box-sizing: border-box; /* easier to make button and A the same size */
    width: 100%;
    height: 35px;
    padding: 0px;
    padding-bottom: 5px;
    background-color: var(--color-header); /* was #3498db */
    border: 1px solid black; 
    border-radius: 5%;
    cursor: pointer;
    /* Firefox uses font -apple-system unless I repeat the font spec here. */
    font-family: var(--font-family);
    color:rgb(240, 248, 244);
    font-weight: bold;
    font-size: 1.4rem;
    text-decoration: None;
}

/* Only the top-level buttons are centered; lower ones are left-aligned. */
nav > ul > li > button , nav > ul > li > a {
    text-align: center;
}

/* because of the margin trick, this can only be used for the last element */

nav li.right {
    margin-left: auto;
}

nav button:hover, button:focus, nav a:hover, nav a:focus {
    background-color: var(--color-focus);
}

form {
    background-color: #e3e3e3; 
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(181, 179, 179, 0.2);
    max-width: 500px;
    margin: auto;
}

.form-group {
    margin-bottom: 15px;
    max-width: 250 px;
}



input[type="text"], input[type="password"] {
    width: 100%;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
}

input[type="submit"] {
    width: 100%;
    background-color: var(--color-header);
    color: white;
    padding: 14px 20px;
    margin: 8px 0;
    border: none;
    border-radius: 4px;
}


label {
    display: block;
    margin-top: 10px;
}

.centered-buttons {
    text-align: center;
    margin-top: 20px;
}


.photobox input[type="submit"] {
    width: 120px; 
    height: 40px; 
    text-align: center;
}

.photobox input[type="file"] {
    display: inline-block; 
}
.photobox p{
    text-align: center;
}


.information-box {
    border: 2px solid rgb(45,45,149); 
    padding: 20px;
    margin: 10px 0; 
    border-radius: 10px; /* Rounded corners */
    background-color:rgb(166, 210, 225) ; 
    max-width: 1000px; 
    margin-right: auto;
}

.information-box .button{
    border: 2px solid rgb(45,45,149); 
    width: 150px; 
    height: 50px; 
    background-color: rgb(250, 250, 250);
    text-align: center;
    line-height: 25px;
    font-size: 15px;
    font-family: serif; 
    border-radius: 8px;
    
}
.your-information {
    text-align: center; 
    color: rgb(45, 45, 149); 
    margin-bottom: 10px;
}

ul {
    padding: 1; /* Removes default padding */
}

li {
    padding: 5px 0; 
}

.posts table, th, td {
    padding: 8px;
    border: 1px solid rgb(246, 242, 242); /* Light border for cells */
  }
.posts table{
    width: 80%;
    margin: 0 auto;
}
.posts td{
    text-align: center;
}

.circular-image {
    max-width: 80%;
    max-height: 300px;
    border-radius: 80%;
    display: block; /* Add this to make margin auto effective */
    margin-left: auto;
    margin-right: auto;
}


.profile_posts {
    font-size: medium;
    font-weight: 200;
    background-color: rgb(247, 247, 247);
    width: 100%; 
    margin-bottom: 20px; /* Margin between posts */
}

.profile_posts th, .profile_posts td {
    padding: 8px;
    border: 1px solid rgb(246, 242, 242); /* Light border for cells */
}

.profile_posts_container {
    height: 300px; 
    overflow-y: auto; /* Allows vertical scrolling */
}

.searchform input[type= "submit"] {
    margin-top: 10px;
    max-width: 40%;
}
